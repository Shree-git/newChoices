{"version":3,"sources":["webpack:///node_modules/@firebase/installations/dist/index.esm.js","webpack:///node_modules/@firebase/installations/node_modules/tslib/tslib.es6.js","webpack:///node_modules/@firebase/messaging/dist/index.esm.js","webpack:///node_modules/@firebase/messaging/node_modules/tslib/tslib.es6.js","webpack:///node_modules/firebase/messaging/dist/index.esm.js","webpack:///node_modules/idb/build/idb.js"],"names":["name","version","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","SERVICE","SERVICE_NAME","_a","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","error","code","includes","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","getExpiresInFromResponseExpiresIn","creationTime","Date","now","getErrorFromResponse","requestName","responseJson","errorData","label","json","sent","create","serverCode","serverMessage","message","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","getAuthorizationHeader","retryIfServerError","fn","result","responseExpiresIn","Number","replace","createInstallationRequest","fid","endpoint","body","request","responseValue","registeredInstallationEntry","_b","authVersion","appId","sdkVersion","method","JSON","stringify","fetch","ok","registrationStatus","authToken","sleep","ms","Promise","resolve","setTimeout","bufferToBase64UrlSafe","array","b64","btoa","String","fromCharCode","apply","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","crypto_1","self","crypto","msCrypto","getRandomValues","encode","test","b64String","substr","getKey","appName","fidChangeCallbacks","Map","fidChanged","key","callFidChangeCallbacks","broadcastFidChange","addCallback","callback","getBroadcastChannel","callbackSet","get","Set","set","add","removeCallback","size","closeBroadcastChannel","e_1","callbacks","callbacks_1","callbacks_1_1","next","done","value","e_1_1","call","channel","postMessage","broadcastChannel","BroadcastChannel","onmessage","e","data","close","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","db","tx","objectStore","oldValue","transaction","put","complete","remove","update","updateFn","store","newValue","undefined","getInstallationEntry","registrationPromise","installationEntry","oldEntry","updateOrCreateInstallationEntry","entryWithPromise","triggerRegistrationIfNecessary","entry","clearTimedOutRequest","navigator","onLine","registrationPromiseWithError","reject","inProgressEntry","registrationTime","registerInstallation","waitUntilFidRegistration","trys","push","updateInstallationRequest","hasInstallationRequestTimedOut","generateAuthTokenRequest","platformLoggerProvider","platformLogger","completedAuthToken","getGenerateAuthTokenEndpoint","getImmediate","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenValid","waitUntilAuthTokenRequest","makeAuthTokenRequestInProgressEntry","fetchAuthTokenFromServer","updateAuthTokenRequest","hasAuthTokenRequestTimedOut","updatedInstallationEntry","isAuthTokenExpired","inProgressAuthToken","requestTime","getId","console","getToken","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","deleteInstallation","onIdChange","extractAppConfig","app","options","getMissingValueError","configKeys","configKeys_1","configKeys_1_1","keyName","valueName","registerInstallations","instance","installationsName","INTERNAL","registerComponent","container","getProvider","installations","registerVersion","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","constructor","prototype","__assign","assign","t","s","i","n","arguments","length","__rest","indexOf","getOwnPropertySymbols","propertyIsEnumerable","__decorate","decorators","target","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__param","paramIndex","decorator","__metadata","metadataKey","metadataValue","metadata","__awaiter","thisArg","_arguments","P","generator","adopt","fulfilled","step","rejected","then","__generator","_","ops","f","y","g","verb","Symbol","iterator","v","op","TypeError","pop","__exportStar","m","exports","__values","o","__read","ar","__spread","concat","__spreadArrays","il","k","a","j","jl","__await","__asyncGenerator","asyncIterator","q","resume","settle","fulfill","shift","__asyncDelegator","__asyncValues","__makeTemplateObject","cooked","raw","__importStar","mod","__esModule","__importDefault","__classPrivateFieldGet","receiver","privateMap","has","__classPrivateFieldSet","ERROR_MAP","senderId","messagingSenderId","arrayToBase64","uint8Array","base64String","base64ToArray","padding","repeat","base64","rawData","atob","outputArray","charCodeAt","OLD_DB_NAME","OLD_DB_VERSION","OLD_OBJECT_STORE_NAME","migrateOldDatabase","databases","dbNames","tokenDetails","_this","indexedDB","map","oldDetails","objectStoreNames","contains","index","clear","auth","p256dh","fcmToken","createTime","subscriptionOptions","swScope","vapidKey","checkTokenDetails","upgradeDb","dbGet","firebaseDependencies","oldTokenDetails","dbSet","dbRemove","DEFAULT_SW_PATH","DEFAULT_SW_SCOPE","DEFAULT_VAPID_KEY","ENDPOINT","FCM_MSG","CONSOLE_CAMPAIGN_ID","CONSOLE_CAMPAIGN_NAME","CONSOLE_CAMPAIGN_TIME","CONSOLE_CAMPAIGN_ANALYTICS_ENABLED","requestGetToken","subscribeOptions","responseData","err_1","getBody","getEndpoint","errorInfo","requestUpdateToken","updateOptions","err_2","requestDeleteToken","unsubscribeOptions","err_3","web","applicationPubKey","TOKEN_EXPIRATION_MS","swRegistration","pushSubscription","Notification","permission","getPushSubscription","scope","getNewToken","isTokenValid","warn","updateToken","deleteToken","pushManager","getSubscription","unsubscribe","updatedToken","updatedTokenDetails","e_2","subscription","subscribe","userVisibleOnly","applicationServerKey","dbOptions","currentOptions","isVapidKeyEqual","isEndpointEqual","isAuthEqual","isP256dhEqual","MessageType","isConsoleMessage","WindowController","onMessageCallback","serviceWorker","addEventListener","messageEventListener","enumerable","configurable","getServiceWorkerRegistration","requestPermission","permissionResult","usePublicVapidKey","useServiceWorker","ServiceWorkerRegistration","onMessage","nextOrObserver","setBackgroundMessageHandler","onTokenRefresh","register","browserErrorMessage","event","type","payload","_c","firebaseMessaging","PUSH_RECEIVED","logEvent","messageType","eventType","analytics","getEventType","analyticsProvider","message_id","message_name","message_time","message_device_time","Math","floor","NOTIFICATION_CLICKED","Error","SwController","bgMessageHandler","waitUntil","onPush","onSubChange","onNotificationClick","registration","clientList","notificationDetails","getMessagePayload","getClientList","hasVisibleClients","sendMessageToWindowClients","getNotificationData","showNotification","newSubscription","link","client","notification","action","stopImmediatePropagation","getLink","getWindowClient","clients","openWindow","focus","createNewMessage","err","notificationInformation","url","parsedURL","clientList_1","clientList_1_1","parsedClientUrl","URL","location","href","host","some","visibilityState","startsWith","clientList_2","clientList_2_1","e_2_1","matchAll","includeUncontrolled","details","title","actions","maxActions","fcmOptions","click_action","origin","MESSAGING_NAME","factoryMethod","isSupported","NAMESPACE_EXPORTS","setServiceProps","isSWControllerSupported","isWindowControllerSupported","window","cookieEnabled","PushSubscription","global","factory","toArray","arr","slice","promisifyRequest","onsuccess","onerror","promisifyRequestCall","obj","args","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","val","proxyRequestMethods","Constructor","proxyMethods","proxyCursorRequestMethods","Index","_index","IDBIndex","cursor","_cursor","_request","IDBCursor","methodName","ObjectStore","_store","createIndex","IDBObjectStore","Transaction","idbTransaction","_tx","oncomplete","onabort","IDBTransaction","UpgradeDB","_db","IDBDatabase","DB","funcName","nativeObject","getAll","query","count","items","iterateCursor","openDb","upgradeCallback","onupgradeneeded","deleteDb"],"mappings":"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","file":"firebase-messaging-es5.js","sourcesContent":["import firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spread, __values, __assign } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\n\nvar name = \"@firebase/installations\";\nvar version = \"0.4.9\";\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar PENDING_TIMEOUT_MS = 10000;\r\nvar PACKAGE_VERSION = \"w:\" + version;\r\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\r\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\r\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\r\nvar SERVICE = 'installations';\r\nvar SERVICE_NAME = 'Installations';\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_DESCRIPTION_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"not-registered\" /* NOT_REGISTERED */] = 'Firebase Installation is not registered.',\r\n    _a[\"installation-not-found\" /* INSTALLATION_NOT_FOUND */] = 'Firebase Installation not found.',\r\n    _a[\"request-failed\" /* REQUEST_FAILED */] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"',\r\n    _a[\"app-offline\" /* APP_OFFLINE */] = 'Could not process request. Application offline.',\r\n    _a[\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */] = \"Can't delete installation while there is a pending registration request.\",\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\r\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\r\nfunction isServerError(error) {\r\n    return (error instanceof FirebaseError &&\r\n        error.code.includes(\"request-failed\" /* REQUEST_FAILED */));\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getInstallationsEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\r\n}\r\nfunction extractAuthTokenInfoFromResponse(response) {\r\n    return {\r\n        token: response.token,\r\n        requestStatus: 2 /* COMPLETED */,\r\n        expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\r\n        creationTime: Date.now()\r\n    };\r\n}\r\nfunction getErrorFromResponse(requestName, response) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var responseJson, errorData;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, response.json()];\r\n                case 1:\r\n                    responseJson = _a.sent();\r\n                    errorData = responseJson.error;\r\n                    return [2 /*return*/, ERROR_FACTORY.create(\"request-failed\" /* REQUEST_FAILED */, {\r\n                            requestName: requestName,\r\n                            serverCode: errorData.code,\r\n                            serverMessage: errorData.message,\r\n                            serverStatus: errorData.status\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getHeaders(_a) {\r\n    var apiKey = _a.apiKey;\r\n    return new Headers({\r\n        'Content-Type': 'application/json',\r\n        Accept: 'application/json',\r\n        'x-goog-api-key': apiKey\r\n    });\r\n}\r\nfunction getHeadersWithAuth(appConfig, _a) {\r\n    var refreshToken = _a.refreshToken;\r\n    var headers = getHeaders(appConfig);\r\n    headers.append('Authorization', getAuthorizationHeader(refreshToken));\r\n    return headers;\r\n}\r\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\r\nfunction retryIfServerError(fn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var result;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, fn()];\r\n                case 1:\r\n                    result = _a.sent();\r\n                    if (result.status >= 500 && result.status < 600) {\r\n                        // Internal Server Error. Retry request.\r\n                        return [2 /*return*/, fn()];\r\n                    }\r\n                    return [2 /*return*/, result];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\r\n    // This works because the server will never respond with fractions of a second.\r\n    return Number(responseExpiresIn.replace('s', '000'));\r\n}\r\nfunction getAuthorizationHeader(refreshToken) {\r\n    return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction createInstallationRequest(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getInstallationsEndpoint(appConfig);\r\n                    headers = getHeaders(appConfig);\r\n                    body = {\r\n                        fid: fid,\r\n                        authVersion: INTERNAL_AUTH_VERSION,\r\n                        appId: appConfig.appId,\r\n                        sdkVersion: PACKAGE_VERSION\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    registeredInstallationEntry = {\r\n                        fid: responseValue.fid || fid,\r\n                        registrationStatus: 2 /* COMPLETED */,\r\n                        refreshToken: responseValue.refreshToken,\r\n                        authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\r\n                    };\r\n                    return [2 /*return*/, registeredInstallationEntry];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Create Installation', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction bufferToBase64UrlSafe(array) {\r\n    var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\r\n    return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\r\nvar INVALID_FID = '';\r\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\r\nfunction generateFid() {\r\n    try {\r\n        // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\r\n        // bytes. our implementation generates a 17 byte array instead.\r\n        var fidByteArray = new Uint8Array(17);\r\n        var crypto_1 = self.crypto || self.msCrypto;\r\n        crypto_1.getRandomValues(fidByteArray);\r\n        // Replace the first 4 random bits with the constant FID header of 0b0111.\r\n        fidByteArray[0] = 112 + (fidByteArray[0] % 16);\r\n        var fid = encode(fidByteArray);\r\n        return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\r\n    }\r\n    catch (_a) {\r\n        // FID generation errored\r\n        return INVALID_FID;\r\n    }\r\n}\r\n/** Converts a FID Uint8Array to a base64 string representation. */\r\nfunction encode(fidByteArray) {\r\n    var b64String = bufferToBase64UrlSafe(fidByteArray);\r\n    // Remove the 23rd character that was added because of the extra 4 bits at the\r\n    // end of our 17 byte array, and the '=' padding.\r\n    return b64String.substr(0, 22);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a string key that can be used to identify the app. */\r\nfunction getKey(appConfig) {\r\n    return appConfig.appName + \"!\" + appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar fidChangeCallbacks = new Map();\r\n/**\r\n * Calls the onIdChange callbacks with the new FID value, and broadcasts the\r\n * change to other tabs.\r\n */\r\nfunction fidChanged(appConfig, fid) {\r\n    var key = getKey(appConfig);\r\n    callFidChangeCallbacks(key, fid);\r\n    broadcastFidChange(key, fid);\r\n}\r\nfunction addCallback(appConfig, callback) {\r\n    // Open the broadcast channel if it's not already open,\r\n    // to be able to listen to change events from other tabs.\r\n    getBroadcastChannel();\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        callbackSet = new Set();\r\n        fidChangeCallbacks.set(key, callbackSet);\r\n    }\r\n    callbackSet.add(callback);\r\n}\r\nfunction removeCallback(appConfig, callback) {\r\n    var key = getKey(appConfig);\r\n    var callbackSet = fidChangeCallbacks.get(key);\r\n    if (!callbackSet) {\r\n        return;\r\n    }\r\n    callbackSet.delete(callback);\r\n    if (callbackSet.size === 0) {\r\n        fidChangeCallbacks.delete(key);\r\n    }\r\n    // Close broadcast channel if there are no more callbacks.\r\n    closeBroadcastChannel();\r\n}\r\nfunction callFidChangeCallbacks(key, fid) {\r\n    var e_1, _a;\r\n    var callbacks = fidChangeCallbacks.get(key);\r\n    if (!callbacks) {\r\n        return;\r\n    }\r\n    try {\r\n        for (var callbacks_1 = __values(callbacks), callbacks_1_1 = callbacks_1.next(); !callbacks_1_1.done; callbacks_1_1 = callbacks_1.next()) {\r\n            var callback = callbacks_1_1.value;\r\n            callback(fid);\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (callbacks_1_1 && !callbacks_1_1.done && (_a = callbacks_1.return)) _a.call(callbacks_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n}\r\nfunction broadcastFidChange(key, fid) {\r\n    var channel = getBroadcastChannel();\r\n    if (channel) {\r\n        channel.postMessage({ key: key, fid: fid });\r\n    }\r\n    closeBroadcastChannel();\r\n}\r\nvar broadcastChannel = null;\r\n/** Opens and returns a BroadcastChannel if it is supported by the browser. */\r\nfunction getBroadcastChannel() {\r\n    if (!broadcastChannel && 'BroadcastChannel' in self) {\r\n        broadcastChannel = new BroadcastChannel('[Firebase] FID Change');\r\n        broadcastChannel.onmessage = function (e) {\r\n            callFidChangeCallbacks(e.data.key, e.data.fid);\r\n        };\r\n    }\r\n    return broadcastChannel;\r\n}\r\nfunction closeBroadcastChannel() {\r\n    if (fidChangeCallbacks.size === 0 && broadcastChannel) {\r\n        broadcastChannel.close();\r\n        broadcastChannel = null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DATABASE_NAME = 'firebase-installations-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDB.oldVersion) {\r\n                case 0:\r\n                    upgradeDB.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction set(appConfig, value) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, objectStore, oldValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    objectStore = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, objectStore.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    return [4 /*yield*/, objectStore.put(value, key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 4:\r\n                    _a.sent();\r\n                    if (!oldValue || oldValue.fid !== value.fid) {\r\n                        fidChanged(appConfig, value.fid);\r\n                    }\r\n                    return [2 /*return*/, value];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction remove(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\r\nfunction update(appConfig, updateFn) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx, store, oldValue, newValue;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(appConfig);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    store = tx.objectStore(OBJECT_STORE_NAME);\r\n                    return [4 /*yield*/, store.get(key)];\r\n                case 2:\r\n                    oldValue = _a.sent();\r\n                    newValue = updateFn(oldValue);\r\n                    if (!(newValue === undefined)) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, store.delete(key)];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: return [4 /*yield*/, store.put(newValue, key)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [4 /*yield*/, tx.complete];\r\n                case 7:\r\n                    _a.sent();\r\n                    if (newValue && (!oldValue || oldValue.fid !== newValue.fid)) {\r\n                        fidChanged(appConfig, newValue.fid);\r\n                    }\r\n                    return [2 /*return*/, newValue];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\r\nfunction getInstallationEntry(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise, installationEntry, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                        var installationEntry = updateOrCreateInstallationEntry(oldEntry);\r\n                        var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\r\n                        registrationPromise = entryWithPromise.registrationPromise;\r\n                        return entryWithPromise.installationEntry;\r\n                    })];\r\n                case 1:\r\n                    installationEntry = _b.sent();\r\n                    if (!(installationEntry.fid === INVALID_FID)) return [3 /*break*/, 3];\r\n                    _a = {};\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2: \r\n                // FID generation failed. Waiting for the FID from the server.\r\n                return [2 /*return*/, (_a.installationEntry = _b.sent(), _a)];\r\n                case 3: return [2 /*return*/, {\r\n                        installationEntry: installationEntry,\r\n                        registrationPromise: registrationPromise\r\n                    }];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\r\nfunction updateOrCreateInstallationEntry(oldEntry) {\r\n    var entry = oldEntry || {\r\n        fid: generateFid(),\r\n        registrationStatus: 0 /* NOT_STARTED */\r\n    };\r\n    return clearTimedOutRequest(entry);\r\n}\r\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\r\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\r\n    if (installationEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n        if (!navigator.onLine) {\r\n            // Registration required but app is offline.\r\n            var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */));\r\n            return {\r\n                installationEntry: installationEntry,\r\n                registrationPromise: registrationPromiseWithError\r\n            };\r\n        }\r\n        // Try registering. Change status to IN_PROGRESS.\r\n        var inProgressEntry = {\r\n            fid: installationEntry.fid,\r\n            registrationStatus: 1 /* IN_PROGRESS */,\r\n            registrationTime: Date.now()\r\n        };\r\n        var registrationPromise = registerInstallation(appConfig, inProgressEntry);\r\n        return { installationEntry: inProgressEntry, registrationPromise: registrationPromise };\r\n    }\r\n    else if (installationEntry.registrationStatus === 1 /* IN_PROGRESS */) {\r\n        return {\r\n            installationEntry: installationEntry,\r\n            registrationPromise: waitUntilFidRegistration(appConfig)\r\n        };\r\n    }\r\n    else {\r\n        return { installationEntry: installationEntry };\r\n    }\r\n}\r\n/** This will be executed only once for each new Firebase Installation. */\r\nfunction registerInstallation(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registeredInstallationEntry, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 2, , 7]);\r\n                    return [4 /*yield*/, createInstallationRequest(appConfig, installationEntry)];\r\n                case 1:\r\n                    registeredInstallationEntry = _a.sent();\r\n                    return [2 /*return*/, set(appConfig, registeredInstallationEntry)];\r\n                case 2:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3 /*break*/, 4];\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 3:\r\n                    // Server returned a \"FID can not be used\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 4: \r\n                // Registration failed. Set FID as not registered.\r\n                return [4 /*yield*/, set(appConfig, {\r\n                        fid: installationEntry.fid,\r\n                        registrationStatus: 0 /* NOT_STARTED */\r\n                    })];\r\n                case 5:\r\n                    // Registration failed. Set FID as not registered.\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: throw e_1;\r\n                case 7: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Call if FID registration is pending in another request. */\r\nfunction waitUntilFidRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    _b.label = 2;\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // createInstallation request still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // createInstallation request still in progress.\r\n                    _b.sent();\r\n                    return [4 /*yield*/, updateInstallationRequest(appConfig)];\r\n                case 4:\r\n                    entry = _b.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    if (!(entry.registrationStatus === 0 /* NOT_STARTED */)) return [3 /*break*/, 7];\r\n                    return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 6:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        return [2 /*return*/, registrationPromise];\r\n                    }\r\n                    else {\r\n                        // if there is no registrationPromise, entry is registered.\r\n                        return [2 /*return*/, installationEntry];\r\n                    }\r\n                case 7: return [2 /*return*/, entry];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateInstallationRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!oldEntry) {\r\n            throw ERROR_FACTORY.create(\"installation-not-found\" /* INSTALLATION_NOT_FOUND */);\r\n        }\r\n        return clearTimedOutRequest(oldEntry);\r\n    });\r\n}\r\nfunction clearTimedOutRequest(entry) {\r\n    if (hasInstallationRequestTimedOut(entry)) {\r\n        return {\r\n            fid: entry.fid,\r\n            registrationStatus: 0 /* NOT_STARTED */\r\n        };\r\n    }\r\n    return entry;\r\n}\r\nfunction hasInstallationRequestTimedOut(installationEntry) {\r\n    return (installationEntry.registrationStatus === 1 /* IN_PROGRESS */ &&\r\n        installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction generateAuthTokenRequest(_a, installationEntry) {\r\n    var appConfig = _a.appConfig, platformLoggerProvider = _a.platformLoggerProvider;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    platformLogger = platformLoggerProvider.getImmediate({\r\n                        optional: true\r\n                    });\r\n                    if (platformLogger) {\r\n                        headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\r\n                    }\r\n                    body = {\r\n                        installation: {\r\n                            sdkVersion: PACKAGE_VERSION\r\n                        }\r\n                    };\r\n                    request = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _b.sent();\r\n                    if (!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, response.json()];\r\n                case 2:\r\n                    responseValue = _b.sent();\r\n                    completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\r\n                    return [2 /*return*/, completedAuthToken];\r\n                case 3: return [4 /*yield*/, getErrorFromResponse('Generate Auth Token', response)];\r\n                case 4: throw _b.sent();\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\r\nfunction refreshAuthToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenPromise, entry, authToken, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, update(dependencies.appConfig, function (oldEntry) {\r\n                        if (!isEntryRegistered(oldEntry)) {\r\n                            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n                        }\r\n                        var oldAuthToken = oldEntry.authToken;\r\n                        if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\r\n                            // There is a valid token in the DB.\r\n                            return oldEntry;\r\n                        }\r\n                        else if (oldAuthToken.requestStatus === 1 /* IN_PROGRESS */) {\r\n                            // There already is a token request in progress.\r\n                            tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\r\n                            return oldEntry;\r\n                        }\r\n                        else {\r\n                            // No token or token expired.\r\n                            if (!navigator.onLine) {\r\n                                throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                            }\r\n                            var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\r\n                            tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\r\n                            return inProgressEntry;\r\n                        }\r\n                    })];\r\n                case 1:\r\n                    entry = _b.sent();\r\n                    if (!tokenPromise) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, tokenPromise];\r\n                case 2:\r\n                    _a = _b.sent();\r\n                    return [3 /*break*/, 4];\r\n                case 3:\r\n                    _a = entry.authToken;\r\n                    _b.label = 4;\r\n                case 4:\r\n                    authToken = _a;\r\n                    return [2 /*return*/, authToken];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\r\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var entry, authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    _a.label = 2;\r\n                case 2:\r\n                    if (!(entry.authToken.requestStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 5];\r\n                    // generateAuthToken still in progress.\r\n                    return [4 /*yield*/, sleep(100)];\r\n                case 3:\r\n                    // generateAuthToken still in progress.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, updateAuthTokenRequest(dependencies.appConfig)];\r\n                case 4:\r\n                    entry = _a.sent();\r\n                    return [3 /*break*/, 2];\r\n                case 5:\r\n                    authToken = entry.authToken;\r\n                    if (authToken.requestStatus === 0 /* NOT_STARTED */) {\r\n                        // The request timed out or failed in a different call. Try again.\r\n                        return [2 /*return*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                    }\r\n                    else {\r\n                        return [2 /*return*/, authToken];\r\n                    }\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\r\nfunction updateAuthTokenRequest(appConfig) {\r\n    return update(appConfig, function (oldEntry) {\r\n        if (!isEntryRegistered(oldEntry)) {\r\n            throw ERROR_FACTORY.create(\"not-registered\" /* NOT_REGISTERED */);\r\n        }\r\n        var oldAuthToken = oldEntry.authToken;\r\n        if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\r\n            return __assign(__assign({}, oldEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n        }\r\n        return oldEntry;\r\n    });\r\n}\r\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 8]);\r\n                    return [4 /*yield*/, generateAuthTokenRequest(dependencies, installationEntry)];\r\n                case 1:\r\n                    authToken = _a.sent();\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: authToken });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, authToken];\r\n                case 3:\r\n                    e_1 = _a.sent();\r\n                    if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3 /*break*/, 5];\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    return [4 /*yield*/, remove(dependencies.appConfig)];\r\n                case 4:\r\n                    // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\r\n                    // Generate a new ID next time.\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 5:\r\n                    updatedInstallationEntry = __assign(__assign({}, installationEntry), { authToken: { requestStatus: 0 /* NOT_STARTED */ } });\r\n                    return [4 /*yield*/, set(dependencies.appConfig, updatedInstallationEntry)];\r\n                case 6:\r\n                    _a.sent();\r\n                    _a.label = 7;\r\n                case 7: throw e_1;\r\n                case 8: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction isEntryRegistered(installationEntry) {\r\n    return (installationEntry !== undefined &&\r\n        installationEntry.registrationStatus === 2 /* COMPLETED */);\r\n}\r\nfunction isAuthTokenValid(authToken) {\r\n    return (authToken.requestStatus === 2 /* COMPLETED */ &&\r\n        !isAuthTokenExpired(authToken));\r\n}\r\nfunction isAuthTokenExpired(authToken) {\r\n    var now = Date.now();\r\n    return (now < authToken.creationTime ||\r\n        authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER);\r\n}\r\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\r\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\r\n    var inProgressAuthToken = {\r\n        requestStatus: 1 /* IN_PROGRESS */,\r\n        requestTime: Date.now()\r\n    };\r\n    return __assign(__assign({}, oldEntry), { authToken: inProgressAuthToken });\r\n}\r\nfunction hasAuthTokenRequestTimedOut(authToken) {\r\n    return (authToken.requestStatus === 1 /* IN_PROGRESS */ &&\r\n        authToken.requestTime + PENDING_TIMEOUT_MS < Date.now());\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getId(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var _a, installationEntry, registrationPromise;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(dependencies.appConfig)];\r\n                case 1:\r\n                    _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\r\n                    if (registrationPromise) {\r\n                        registrationPromise.catch(console.error);\r\n                    }\r\n                    else {\r\n                        // If the installation is already registered, update the authentication\r\n                        // token if needed.\r\n                        refreshAuthToken(dependencies).catch(console.error);\r\n                    }\r\n                    return [2 /*return*/, installationEntry.fid];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction getToken(dependencies, forceRefresh) {\r\n    if (forceRefresh === void 0) { forceRefresh = false; }\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, completeInstallationRegistration(dependencies.appConfig)];\r\n                case 1:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, refreshAuthToken(dependencies, forceRefresh)];\r\n                case 2:\r\n                    authToken = _a.sent();\r\n                    return [2 /*return*/, authToken.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction completeInstallationRegistration(appConfig) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var registrationPromise;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getInstallationEntry(appConfig)];\r\n                case 1:\r\n                    registrationPromise = (_a.sent()).registrationPromise;\r\n                    if (!registrationPromise) return [3 /*break*/, 3];\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    return [4 /*yield*/, registrationPromise];\r\n                case 2:\r\n                    // A createInstallation request is in progress. Wait until it finishes.\r\n                    _a.sent();\r\n                    _a.label = 3;\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallationRequest(appConfig, installationEntry) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var endpoint, headers, request, response;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    endpoint = getDeleteEndpoint(appConfig, installationEntry);\r\n                    headers = getHeadersWithAuth(appConfig, installationEntry);\r\n                    request = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    return [4 /*yield*/, retryIfServerError(function () { return fetch(endpoint, request); })];\r\n                case 1:\r\n                    response = _a.sent();\r\n                    if (!!response.ok) return [3 /*break*/, 3];\r\n                    return [4 /*yield*/, getErrorFromResponse('Delete Installation', response)];\r\n                case 2: throw _a.sent();\r\n                case 3: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getDeleteEndpoint(appConfig, _a) {\r\n    var fid = _a.fid;\r\n    return getInstallationsEndpoint(appConfig) + \"/\" + fid;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction deleteInstallation(dependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var appConfig, entry;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    appConfig = dependencies.appConfig;\r\n                    return [4 /*yield*/, update(appConfig, function (oldEntry) {\r\n                            if (oldEntry && oldEntry.registrationStatus === 0 /* NOT_STARTED */) {\r\n                                // Delete the unregistered entry without sending a deleteInstallation request.\r\n                                return undefined;\r\n                            }\r\n                            return oldEntry;\r\n                        })];\r\n                case 1:\r\n                    entry = _a.sent();\r\n                    if (!entry) return [3 /*break*/, 6];\r\n                    if (!(entry.registrationStatus === 1 /* IN_PROGRESS */)) return [3 /*break*/, 2];\r\n                    // Can't delete while trying to register.\r\n                    throw ERROR_FACTORY.create(\"delete-pending-registration\" /* DELETE_PENDING_REGISTRATION */);\r\n                case 2:\r\n                    if (!(entry.registrationStatus === 2 /* COMPLETED */)) return [3 /*break*/, 6];\r\n                    if (!!navigator.onLine) return [3 /*break*/, 3];\r\n                    throw ERROR_FACTORY.create(\"app-offline\" /* APP_OFFLINE */);\r\n                case 3: return [4 /*yield*/, deleteInstallationRequest(appConfig, entry)];\r\n                case 4:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, remove(appConfig)];\r\n                case 5:\r\n                    _a.sent();\r\n                    _a.label = 6;\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/**\r\n * Sets a new callback that will get called when Installation ID changes.\r\n * Returns an unsubscribe function that will remove the callback when called.\r\n */\r\nfunction onIdChange(_a, callback) {\r\n    var appConfig = _a.appConfig;\r\n    addCallback(appConfig, callback);\r\n    return function () {\r\n        removeCallback(appConfig, callback);\r\n    };\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId'\r\n    ];\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!app.options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: app.options.projectId,\r\n        apiKey: app.options.apiKey,\r\n        appId: app.options.appId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction registerInstallations(instance) {\r\n    var installationsName = 'installations';\r\n    instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\r\n        var app = container.getProvider('app').getImmediate();\r\n        // Throws if app isn't configured properly.\r\n        var appConfig = extractAppConfig(app);\r\n        var platformLoggerProvider = container.getProvider('platform-logger');\r\n        var dependencies = {\r\n            appConfig: appConfig,\r\n            platformLoggerProvider: platformLoggerProvider\r\n        };\r\n        var installations = {\r\n            app: app,\r\n            getId: function () { return getId(dependencies); },\r\n            getToken: function (forceRefresh) {\r\n                return getToken(dependencies, forceRefresh);\r\n            },\r\n            delete: function () { return deleteInstallation(dependencies); },\r\n            onIdChange: function (callback) {\r\n                return onIdChange(dependencies, callback);\r\n            }\r\n        };\r\n        return installations;\r\n    }, \"PUBLIC\" /* PUBLIC */));\r\n    instance.registerVersion(name, version);\r\n}\r\nregisterInstallations(firebase);\n\nexport { registerInstallations };\n//# sourceMappingURL=index.esm.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import firebase from '@firebase/app';\nimport '@firebase/installations';\nimport { Component } from '@firebase/component';\nimport { __values, __spread, __awaiter, __generator, __assign } from 'tslib';\nimport { ErrorFactory } from '@firebase/util';\nimport { deleteDb, openDb } from 'idb';\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar _a;\r\nvar ERROR_MAP = (_a = {},\r\n    _a[\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */] = 'Missing App configuration value: \"{$valueName}\"',\r\n    _a[\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */] = 'This method is available in a Window context.',\r\n    _a[\"only-available-in-sw\" /* AVAILABLE_IN_SW */] = 'This method is available in a service worker context.',\r\n    _a[\"permission-default\" /* PERMISSION_DEFAULT */] = 'The notification permission was not granted and dismissed instead.',\r\n    _a[\"permission-blocked\" /* PERMISSION_BLOCKED */] = 'The notification permission was not granted and blocked instead.',\r\n    _a[\"unsupported-browser\" /* UNSUPPORTED_BROWSER */] = \"This browser doesn't support the API's required to use the firebase SDK.\",\r\n    _a[\"failed-service-worker-registration\" /* FAILED_DEFAULT_REGISTRATION */] = 'We are unable to register the default service worker. {$browserErrorMessage}',\r\n    _a[\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */] = 'A problem occured while subscribing the user to FCM: {$errorInfo}',\r\n    _a[\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */] = 'FCM returned no token when subscribing the user to push.',\r\n    _a[\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */] = 'A problem occured while unsubscribing the ' +\r\n        'user from FCM: {$errorInfo}',\r\n    _a[\"token-update-failed\" /* TOKEN_UPDATE_FAILED */] = 'A problem occured while updating the user from FCM: {$errorInfo}',\r\n    _a[\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */] = 'FCM returned no token when updating the user to push.',\r\n    _a[\"use-sw-after-get-token\" /* USE_SW_AFTER_GET_TOKEN */] = 'The useServiceWorker() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your service worker is used.',\r\n    _a[\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */] = 'The input to useServiceWorker() must be a ServiceWorkerRegistration.',\r\n    _a[\"invalid-bg-handler\" /* INVALID_BG_HANDLER */] = 'The input to setBackgroundMessageHandler() must be a function.',\r\n    _a[\"invalid-vapid-key\" /* INVALID_VAPID_KEY */] = 'The public VAPID key must be a string.',\r\n    _a[\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */] = 'The usePublicVapidKey() method may only be called once and must be ' +\r\n        'called before calling getToken() to ensure your VAPID key is used.',\r\n    _a);\r\nvar ERROR_FACTORY = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction extractAppConfig(app) {\r\n    var e_1, _a;\r\n    if (!app || !app.options) {\r\n        throw getMissingValueError('App Configuration Object');\r\n    }\r\n    if (!app.name) {\r\n        throw getMissingValueError('App Name');\r\n    }\r\n    // Required app config keys\r\n    var configKeys = [\r\n        'projectId',\r\n        'apiKey',\r\n        'appId',\r\n        'messagingSenderId'\r\n    ];\r\n    var options = app.options;\r\n    try {\r\n        for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\r\n            var keyName = configKeys_1_1.value;\r\n            if (!options[keyName]) {\r\n                throw getMissingValueError(keyName);\r\n            }\r\n        }\r\n    }\r\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n    finally {\r\n        try {\r\n            if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1.return)) _a.call(configKeys_1);\r\n        }\r\n        finally { if (e_1) throw e_1.error; }\r\n    }\r\n    return {\r\n        appName: app.name,\r\n        projectId: options.projectId,\r\n        apiKey: options.apiKey,\r\n        appId: options.appId,\r\n        senderId: options.messagingSenderId\r\n    };\r\n}\r\nfunction getMissingValueError(valueName) {\r\n    return ERROR_FACTORY.create(\"missing-app-config-values\" /* MISSING_APP_CONFIG_VALUES */, {\r\n        valueName: valueName\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction arrayToBase64(array) {\r\n    var uint8Array = new Uint8Array(array);\r\n    var base64String = btoa(String.fromCharCode.apply(String, __spread(uint8Array)));\r\n    return base64String\r\n        .replace(/=/g, '')\r\n        .replace(/\\+/g, '-')\r\n        .replace(/\\//g, '_');\r\n}\r\nfunction base64ToArray(base64String) {\r\n    var padding = '='.repeat((4 - (base64String.length % 4)) % 4);\r\n    var base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n    var rawData = atob(base64);\r\n    var outputArray = new Uint8Array(rawData.length);\r\n    for (var i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n    }\r\n    return outputArray;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar OLD_DB_NAME = 'fcm_token_details_db';\r\n/**\r\n * The last DB version of 'fcm_token_details_db' was 4. This is one higher,\r\n * so that the upgrade callback is called for all versions of the old DB.\r\n */\r\nvar OLD_DB_VERSION = 5;\r\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\r\nfunction migrateOldDatabase(senderId) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var databases, dbNames, tokenDetails, db;\r\n        var _this = this;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (!('databases' in indexedDB)) return [3 /*break*/, 2];\r\n                    return [4 /*yield*/, indexedDB.databases()];\r\n                case 1:\r\n                    databases = _a.sent();\r\n                    dbNames = databases.map(function (db) { return db.name; });\r\n                    if (!dbNames.includes(OLD_DB_NAME)) {\r\n                        // old DB didn't exist, no need to open.\r\n                        return [2 /*return*/, null];\r\n                    }\r\n                    _a.label = 2;\r\n                case 2:\r\n                    tokenDetails = null;\r\n                    return [4 /*yield*/, openDb(OLD_DB_NAME, OLD_DB_VERSION, function (db) { return __awaiter(_this, void 0, void 0, function () {\r\n                            var objectStore, value, oldDetails, oldDetails, oldDetails;\r\n                            var _a;\r\n                            return __generator(this, function (_b) {\r\n                                switch (_b.label) {\r\n                                    case 0:\r\n                                        if (db.oldVersion < 2) {\r\n                                            // Database too old, skip migration.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\r\n                                            // Database did not exist. Nothing to do.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        objectStore = db.transaction.objectStore(OLD_OBJECT_STORE_NAME);\r\n                                        return [4 /*yield*/, objectStore.index('fcmSenderId').get(senderId)];\r\n                                    case 1:\r\n                                        value = _b.sent();\r\n                                        return [4 /*yield*/, objectStore.clear()];\r\n                                    case 2:\r\n                                        _b.sent();\r\n                                        if (!value) {\r\n                                            // No entry in the database, nothing to migrate.\r\n                                            return [2 /*return*/];\r\n                                        }\r\n                                        if (db.oldVersion === 2) {\r\n                                            oldDetails = value;\r\n                                            if (!oldDetails.auth || !oldDetails.p256dh || !oldDetails.endpoint) {\r\n                                                return [2 /*return*/];\r\n                                            }\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: (_a = oldDetails.createTime) !== null && _a !== void 0 ? _a : Date.now(),\r\n                                                subscriptionOptions: {\r\n                                                    auth: oldDetails.auth,\r\n                                                    p256dh: oldDetails.p256dh,\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: typeof oldDetails.vapidKey === 'string'\r\n                                                        ? oldDetails.vapidKey\r\n                                                        : arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        else if (db.oldVersion === 3) {\r\n                                            oldDetails = value;\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: oldDetails.createTime,\r\n                                                subscriptionOptions: {\r\n                                                    auth: arrayToBase64(oldDetails.auth),\r\n                                                    p256dh: arrayToBase64(oldDetails.p256dh),\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        else if (db.oldVersion === 4) {\r\n                                            oldDetails = value;\r\n                                            tokenDetails = {\r\n                                                token: oldDetails.fcmToken,\r\n                                                createTime: oldDetails.createTime,\r\n                                                subscriptionOptions: {\r\n                                                    auth: arrayToBase64(oldDetails.auth),\r\n                                                    p256dh: arrayToBase64(oldDetails.p256dh),\r\n                                                    endpoint: oldDetails.endpoint,\r\n                                                    swScope: oldDetails.swScope,\r\n                                                    vapidKey: arrayToBase64(oldDetails.vapidKey)\r\n                                                }\r\n                                            };\r\n                                        }\r\n                                        return [2 /*return*/];\r\n                                }\r\n                            });\r\n                        }); })];\r\n                case 3:\r\n                    db = _a.sent();\r\n                    db.close();\r\n                    // Delete all old databases.\r\n                    return [4 /*yield*/, deleteDb(OLD_DB_NAME)];\r\n                case 4:\r\n                    // Delete all old databases.\r\n                    _a.sent();\r\n                    return [4 /*yield*/, deleteDb('fcm_vapid_details_db')];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, deleteDb('undefined')];\r\n                case 6:\r\n                    _a.sent();\r\n                    return [2 /*return*/, checkTokenDetails(tokenDetails) ? tokenDetails : null];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction checkTokenDetails(tokenDetails) {\r\n    if (!tokenDetails || !tokenDetails.subscriptionOptions) {\r\n        return false;\r\n    }\r\n    var subscriptionOptions = tokenDetails.subscriptionOptions;\r\n    return (typeof tokenDetails.createTime === 'number' &&\r\n        tokenDetails.createTime > 0 &&\r\n        typeof tokenDetails.token === 'string' &&\r\n        tokenDetails.token.length > 0 &&\r\n        typeof subscriptionOptions.auth === 'string' &&\r\n        subscriptionOptions.auth.length > 0 &&\r\n        typeof subscriptionOptions.p256dh === 'string' &&\r\n        subscriptionOptions.p256dh.length > 0 &&\r\n        typeof subscriptionOptions.endpoint === 'string' &&\r\n        subscriptionOptions.endpoint.length > 0 &&\r\n        typeof subscriptionOptions.swScope === 'string' &&\r\n        subscriptionOptions.swScope.length > 0 &&\r\n        typeof subscriptionOptions.vapidKey === 'string' &&\r\n        subscriptionOptions.vapidKey.length > 0);\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n// Exported for tests.\r\nvar DATABASE_NAME = 'firebase-messaging-database';\r\nvar DATABASE_VERSION = 1;\r\nvar OBJECT_STORE_NAME = 'firebase-messaging-store';\r\nvar dbPromise = null;\r\nfunction getDbPromise() {\r\n    if (!dbPromise) {\r\n        dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDb) {\r\n            // We don't use 'break' in this switch statement, the fall-through\r\n            // behavior is what we want, because if there are multiple versions between\r\n            // the old version and the current version, we want ALL the migrations\r\n            // that correspond to those versions to run, not only the last one.\r\n            // eslint-disable-next-line default-case\r\n            switch (upgradeDb.oldVersion) {\r\n                case 0:\r\n                    upgradeDb.createObjectStore(OBJECT_STORE_NAME);\r\n            }\r\n        });\r\n    }\r\n    return dbPromise;\r\n}\r\n/** Gets record(s) from the objectStore that match the given key. */\r\nfunction dbGet(firebaseDependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tokenDetails, oldTokenDetails;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    return [4 /*yield*/, db\r\n                            .transaction(OBJECT_STORE_NAME)\r\n                            .objectStore(OBJECT_STORE_NAME)\r\n                            .get(key)];\r\n                case 2:\r\n                    tokenDetails = _a.sent();\r\n                    if (!tokenDetails) return [3 /*break*/, 3];\r\n                    return [2 /*return*/, tokenDetails];\r\n                case 3: return [4 /*yield*/, migrateOldDatabase(firebaseDependencies.appConfig.senderId)];\r\n                case 4:\r\n                    oldTokenDetails = _a.sent();\r\n                    if (!oldTokenDetails) return [3 /*break*/, 6];\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, oldTokenDetails)];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [2 /*return*/, oldTokenDetails];\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Assigns or overwrites the record for the given key with the given value. */\r\nfunction dbSet(firebaseDependencies, tokenDetails) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).put(tokenDetails, key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/, tokenDetails];\r\n            }\r\n        });\r\n    });\r\n}\r\n/** Removes record(s) from the objectStore that match the given key. */\r\nfunction dbRemove(firebaseDependencies) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var key, db, tx;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    key = getKey(firebaseDependencies);\r\n                    return [4 /*yield*/, getDbPromise()];\r\n                case 1:\r\n                    db = _a.sent();\r\n                    tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\r\n                    return [4 /*yield*/, tx.objectStore(OBJECT_STORE_NAME).delete(key)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, tx.complete];\r\n                case 3:\r\n                    _a.sent();\r\n                    return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getKey(_a) {\r\n    var appConfig = _a.appConfig;\r\n    return appConfig.appId;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\r\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\r\nvar DEFAULT_VAPID_KEY = 'BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4';\r\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\r\n/** Key of FCM Payload in Notification's data field. */\r\nvar FCM_MSG = 'FCM_MSG';\r\nvar CONSOLE_CAMPAIGN_ID = 'google.c.a.c_id';\r\nvar CONSOLE_CAMPAIGN_NAME = 'google.c.a.c_l';\r\nvar CONSOLE_CAMPAIGN_TIME = 'google.c.a.ts';\r\n/** Set to '1' if Analytics is enabled for the campaign */\r\nvar CONSOLE_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction requestGetToken(firebaseDependencies, subscriptionOptions) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var headers, body, subscribeOptions, responseData, response, err_1, message;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    body = getBody(subscriptionOptions);\r\n                    subscribeOptions = {\r\n                        method: 'POST',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig), subscribeOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_1 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                        errorInfo: err_1\r\n                    });\r\n                case 6:\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-subscribe-failed\" /* TOKEN_SUBSCRIBE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    if (!responseData.token) {\r\n                        throw ERROR_FACTORY.create(\"token-subscribe-no-token\" /* TOKEN_SUBSCRIBE_NO_TOKEN */);\r\n                    }\r\n                    return [2 /*return*/, responseData.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction requestUpdateToken(firebaseDependencies, tokenDetails) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var headers, body, updateOptions, responseData, response, err_2, message;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    body = getBody(tokenDetails.subscriptionOptions);\r\n                    updateOptions = {\r\n                        method: 'PATCH',\r\n                        headers: headers,\r\n                        body: JSON.stringify(body)\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + tokenDetails.token, updateOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_2 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                        errorInfo: err_2\r\n                    });\r\n                case 6:\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-update-failed\" /* TOKEN_UPDATE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    if (!responseData.token) {\r\n                        throw ERROR_FACTORY.create(\"token-update-no-token\" /* TOKEN_UPDATE_NO_TOKEN */);\r\n                    }\r\n                    return [2 /*return*/, responseData.token];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction requestDeleteToken(firebaseDependencies, token) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var headers, unsubscribeOptions, response, responseData, message, err_3;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, getHeaders(firebaseDependencies)];\r\n                case 1:\r\n                    headers = _a.sent();\r\n                    unsubscribeOptions = {\r\n                        method: 'DELETE',\r\n                        headers: headers\r\n                    };\r\n                    _a.label = 2;\r\n                case 2:\r\n                    _a.trys.push([2, 5, , 6]);\r\n                    return [4 /*yield*/, fetch(getEndpoint(firebaseDependencies.appConfig) + \"/\" + token, unsubscribeOptions)];\r\n                case 3:\r\n                    response = _a.sent();\r\n                    return [4 /*yield*/, response.json()];\r\n                case 4:\r\n                    responseData = _a.sent();\r\n                    if (responseData.error) {\r\n                        message = responseData.error.message;\r\n                        throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                            errorInfo: message\r\n                        });\r\n                    }\r\n                    return [3 /*break*/, 6];\r\n                case 5:\r\n                    err_3 = _a.sent();\r\n                    throw ERROR_FACTORY.create(\"token-unsubscribe-failed\" /* TOKEN_UNSUBSCRIBE_FAILED */, {\r\n                        errorInfo: err_3\r\n                    });\r\n                case 6: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getEndpoint(_a) {\r\n    var projectId = _a.projectId;\r\n    return ENDPOINT + \"/projects/\" + projectId + \"/registrations\";\r\n}\r\nfunction getHeaders(_a) {\r\n    var appConfig = _a.appConfig, installations = _a.installations;\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var authToken;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0: return [4 /*yield*/, installations.getToken()];\r\n                case 1:\r\n                    authToken = _b.sent();\r\n                    return [2 /*return*/, new Headers({\r\n                            'Content-Type': 'application/json',\r\n                            Accept: 'application/json',\r\n                            'x-goog-api-key': appConfig.apiKey,\r\n                            'x-goog-firebase-installations-auth': \"FIS \" + authToken\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getBody(_a) {\r\n    var p256dh = _a.p256dh, auth = _a.auth, endpoint = _a.endpoint, vapidKey = _a.vapidKey;\r\n    var body = {\r\n        web: {\r\n            endpoint: endpoint,\r\n            auth: auth,\r\n            p256dh: p256dh\r\n        }\r\n    };\r\n    if (vapidKey !== DEFAULT_VAPID_KEY) {\r\n        body.web.applicationPubKey = vapidKey;\r\n    }\r\n    return body;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** UpdateRegistration will be called once every week. */\r\nvar TOKEN_EXPIRATION_MS = 7 * 24 * 60 * 60 * 1000; // 7 days\r\nfunction getToken(firebaseDependencies, swRegistration, vapidKey) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var pushSubscription, tokenDetails, subscriptionOptions, e_1;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    if (Notification.permission !== 'granted') {\r\n                        throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                    }\r\n                    return [4 /*yield*/, getPushSubscription(swRegistration, vapidKey)];\r\n                case 1:\r\n                    pushSubscription = _a.sent();\r\n                    return [4 /*yield*/, dbGet(firebaseDependencies)];\r\n                case 2:\r\n                    tokenDetails = _a.sent();\r\n                    subscriptionOptions = {\r\n                        vapidKey: vapidKey,\r\n                        swScope: swRegistration.scope,\r\n                        endpoint: pushSubscription.endpoint,\r\n                        auth: arrayToBase64(pushSubscription.getKey('auth')),\r\n                        p256dh: arrayToBase64(pushSubscription.getKey('p256dh'))\r\n                    };\r\n                    if (!!tokenDetails) return [3 /*break*/, 3];\r\n                    // No token, get a new one.\r\n                    return [2 /*return*/, getNewToken(firebaseDependencies, subscriptionOptions)];\r\n                case 3:\r\n                    if (!!isTokenValid(tokenDetails.subscriptionOptions, subscriptionOptions)) return [3 /*break*/, 8];\r\n                    _a.label = 4;\r\n                case 4:\r\n                    _a.trys.push([4, 6, , 7]);\r\n                    return [4 /*yield*/, requestDeleteToken(firebaseDependencies, tokenDetails.token)];\r\n                case 5:\r\n                    _a.sent();\r\n                    return [3 /*break*/, 7];\r\n                case 6:\r\n                    e_1 = _a.sent();\r\n                    // Suppress errors because of #2364\r\n                    console.warn(e_1);\r\n                    return [3 /*break*/, 7];\r\n                case 7: return [2 /*return*/, getNewToken(firebaseDependencies, subscriptionOptions)];\r\n                case 8:\r\n                    if (Date.now() >= tokenDetails.createTime + TOKEN_EXPIRATION_MS) {\r\n                        // Weekly token refresh\r\n                        return [2 /*return*/, updateToken({\r\n                                token: tokenDetails.token,\r\n                                createTime: Date.now(),\r\n                                subscriptionOptions: subscriptionOptions\r\n                            }, firebaseDependencies, swRegistration)];\r\n                    }\r\n                    else {\r\n                        // Valid token, nothing to do.\r\n                        return [2 /*return*/, tokenDetails.token];\r\n                    }\r\n                case 9: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * This method deletes the token from the database, unsubscribes the token from\r\n * FCM, and unregisters the push subscription if it exists.\r\n */\r\nfunction deleteToken(firebaseDependencies, swRegistration) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var tokenDetails, pushSubscription;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, dbGet(firebaseDependencies)];\r\n                case 1:\r\n                    tokenDetails = _a.sent();\r\n                    if (!tokenDetails) return [3 /*break*/, 4];\r\n                    return [4 /*yield*/, requestDeleteToken(firebaseDependencies, tokenDetails.token)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [4 /*yield*/, dbRemove(firebaseDependencies)];\r\n                case 3:\r\n                    _a.sent();\r\n                    _a.label = 4;\r\n                case 4: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                case 5:\r\n                    pushSubscription = _a.sent();\r\n                    if (pushSubscription) {\r\n                        return [2 /*return*/, pushSubscription.unsubscribe()];\r\n                    }\r\n                    // If there's no SW, consider it a success.\r\n                    return [2 /*return*/, true];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction updateToken(tokenDetails, firebaseDependencies, swRegistration) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var updatedToken, updatedTokenDetails, e_2;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0:\r\n                    _a.trys.push([0, 3, , 5]);\r\n                    return [4 /*yield*/, requestUpdateToken(firebaseDependencies, tokenDetails)];\r\n                case 1:\r\n                    updatedToken = _a.sent();\r\n                    updatedTokenDetails = __assign({ token: updatedToken, createTime: Date.now() }, tokenDetails);\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, updatedTokenDetails)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, updatedToken];\r\n                case 3:\r\n                    e_2 = _a.sent();\r\n                    return [4 /*yield*/, deleteToken(firebaseDependencies, swRegistration)];\r\n                case 4:\r\n                    _a.sent();\r\n                    throw e_2;\r\n                case 5: return [2 /*return*/];\r\n            }\r\n        });\r\n    });\r\n}\r\nfunction getNewToken(firebaseDependencies, subscriptionOptions) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var token, tokenDetails;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, requestGetToken(firebaseDependencies, subscriptionOptions)];\r\n                case 1:\r\n                    token = _a.sent();\r\n                    tokenDetails = {\r\n                        token: token,\r\n                        createTime: Date.now(),\r\n                        subscriptionOptions: subscriptionOptions\r\n                    };\r\n                    return [4 /*yield*/, dbSet(firebaseDependencies, tokenDetails)];\r\n                case 2:\r\n                    _a.sent();\r\n                    return [2 /*return*/, tokenDetails.token];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Gets a PushSubscription for the current user.\r\n */\r\nfunction getPushSubscription(swRegistration, vapidKey) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var subscription;\r\n        return __generator(this, function (_a) {\r\n            switch (_a.label) {\r\n                case 0: return [4 /*yield*/, swRegistration.pushManager.getSubscription()];\r\n                case 1:\r\n                    subscription = _a.sent();\r\n                    if (subscription) {\r\n                        return [2 /*return*/, subscription];\r\n                    }\r\n                    return [2 /*return*/, swRegistration.pushManager.subscribe({\r\n                            userVisibleOnly: true,\r\n                            // Chrome <= 75 doesn't support base64-encoded VAPID key. For backward compatibility, VAPID key\r\n                            // submitted to pushManager#subscribe must be of type Uint8Array.\r\n                            applicationServerKey: base64ToArray(vapidKey)\r\n                        })];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * Checks if the saved tokenDetails object matches the configuration provided.\r\n */\r\nfunction isTokenValid(dbOptions, currentOptions) {\r\n    var isVapidKeyEqual = currentOptions.vapidKey === dbOptions.vapidKey;\r\n    var isEndpointEqual = currentOptions.endpoint === dbOptions.endpoint;\r\n    var isAuthEqual = currentOptions.auth === dbOptions.auth;\r\n    var isP256dhEqual = currentOptions.p256dh === dbOptions.p256dh;\r\n    return isVapidKeyEqual && isEndpointEqual && isAuthEqual && isP256dhEqual;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MessageType;\r\n(function (MessageType) {\r\n    MessageType[\"PUSH_RECEIVED\"] = \"push-received\";\r\n    MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\r\n})(MessageType || (MessageType = {}));\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nfunction isConsoleMessage(data) {\r\n    // This message has a campaign ID, meaning it was sent using the\r\n    // Firebase Console.\r\n    return typeof data === 'object' && !!data && CONSOLE_CAMPAIGN_ID in data;\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar WindowController = /** @class */ (function () {\r\n    function WindowController(firebaseDependencies) {\r\n        var _this = this;\r\n        this.firebaseDependencies = firebaseDependencies;\r\n        this.vapidKey = null;\r\n        this.onMessageCallback = null;\r\n        navigator.serviceWorker.addEventListener('message', function (e) {\r\n            return _this.messageEventListener(e);\r\n        });\r\n    }\r\n    Object.defineProperty(WindowController.prototype, \"app\", {\r\n        get: function () {\r\n            return this.firebaseDependencies.app;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    WindowController.prototype.getToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var swRegistration;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (!this.vapidKey) {\r\n                            this.vapidKey = DEFAULT_VAPID_KEY;\r\n                        }\r\n                        return [4 /*yield*/, this.getServiceWorkerRegistration()];\r\n                    case 1:\r\n                        swRegistration = _a.sent();\r\n                        if (!(Notification.permission === 'default')) return [3 /*break*/, 3];\r\n                        // The user hasn't allowed or denied notifications yet. Ask them.\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 2:\r\n                        // The user hasn't allowed or denied notifications yet. Ask them.\r\n                        _a.sent();\r\n                        _a.label = 3;\r\n                    case 3:\r\n                        if (Notification.permission !== 'granted') {\r\n                            throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        return [2 /*return*/, getToken(this.firebaseDependencies, swRegistration, this.vapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.deleteToken = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var swRegistration;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0: return [4 /*yield*/, this.getServiceWorkerRegistration()];\r\n                    case 1:\r\n                        swRegistration = _a.sent();\r\n                        return [2 /*return*/, deleteToken(this.firebaseDependencies, swRegistration)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Request permission if it is not currently granted.\r\n     *\r\n     * @return Resolves if the permission was granted, rejects otherwise.\r\n     *\r\n     * @deprecated Use Notification.requestPermission() instead.\r\n     * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n     */\r\n    WindowController.prototype.requestPermission = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var permissionResult;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        if (Notification.permission === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, Notification.requestPermission()];\r\n                    case 1:\r\n                        permissionResult = _a.sent();\r\n                        if (permissionResult === 'granted') {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (permissionResult === 'denied') {\r\n                            throw ERROR_FACTORY.create(\"permission-blocked\" /* PERMISSION_BLOCKED */);\r\n                        }\r\n                        else {\r\n                            throw ERROR_FACTORY.create(\"permission-default\" /* PERMISSION_DEFAULT */);\r\n                        }\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // TODO: Deprecate this and make VAPID key a parameter in getToken.\r\n    WindowController.prototype.usePublicVapidKey = function (vapidKey) {\r\n        if (this.vapidKey !== null) {\r\n            throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */);\r\n        }\r\n        if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\r\n            throw ERROR_FACTORY.create(\"invalid-vapid-key\" /* INVALID_VAPID_KEY */);\r\n        }\r\n        this.vapidKey = vapidKey;\r\n    };\r\n    WindowController.prototype.useServiceWorker = function (swRegistration) {\r\n        if (!(swRegistration instanceof ServiceWorkerRegistration)) {\r\n            throw ERROR_FACTORY.create(\"invalid-sw-registration\" /* INVALID_SW_REGISTRATION */);\r\n        }\r\n        if (this.swRegistration) {\r\n            throw ERROR_FACTORY.create(\"use-sw-after-get-token\" /* USE_SW_AFTER_GET_TOKEN */);\r\n        }\r\n        this.swRegistration = swRegistration;\r\n    };\r\n    /**\r\n     * @param nextOrObserver An observer object or a function triggered on\r\n     * message.\r\n     * @return The unsubscribe function for the observer.\r\n     */\r\n    // TODO: Simplify this to only accept a function and not an Observer.\r\n    WindowController.prototype.onMessage = function (nextOrObserver) {\r\n        var _this = this;\r\n        this.onMessageCallback =\r\n            typeof nextOrObserver === 'function'\r\n                ? nextOrObserver\r\n                : nextOrObserver.next;\r\n        return function () {\r\n            _this.onMessageCallback = null;\r\n        };\r\n    };\r\n    WindowController.prototype.setBackgroundMessageHandler = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-sw\" /* AVAILABLE_IN_SW */);\r\n    };\r\n    // Unimplemented\r\n    WindowController.prototype.onTokenRefresh = function () {\r\n        return function () { };\r\n    };\r\n    /**\r\n     * Creates or updates the default service worker registration.\r\n     * @return The service worker registration to be used for the push service.\r\n     */\r\n    WindowController.prototype.getServiceWorkerRegistration = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _a, e_1;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        if (!!this.swRegistration) return [3 /*break*/, 4];\r\n                        _b.label = 1;\r\n                    case 1:\r\n                        _b.trys.push([1, 3, , 4]);\r\n                        _a = this;\r\n                        return [4 /*yield*/, navigator.serviceWorker.register(DEFAULT_SW_PATH, {\r\n                                scope: DEFAULT_SW_SCOPE\r\n                            })];\r\n                    case 2:\r\n                        _a.swRegistration = _b.sent();\r\n                        // The timing when browser updates sw when sw has an update is unreliable by my experiment.\r\n                        // It leads to version conflict when the SDK upgrades to a newer version in the main page, but\r\n                        // sw is stuck with the old version. For example, https://github.com/firebase/firebase-js-sdk/issues/2590\r\n                        // The following line reliably updates sw if there was an update.\r\n                        this.swRegistration.update().catch(function () {\r\n                            /* it is non blocking and we don't care if it failed */\r\n                        });\r\n                        return [3 /*break*/, 4];\r\n                    case 3:\r\n                        e_1 = _b.sent();\r\n                        throw ERROR_FACTORY.create(\"failed-service-worker-registration\" /* FAILED_DEFAULT_REGISTRATION */, {\r\n                            browserErrorMessage: e_1.message\r\n                        });\r\n                    case 4: return [2 /*return*/, this.swRegistration];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.messageEventListener = function (event) {\r\n        var _a;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var _b, type, payload, data;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        if (!((_a = event.data) === null || _a === void 0 ? void 0 : _a.firebaseMessaging)) {\r\n                            // Not a message from FCM\r\n                            return [2 /*return*/];\r\n                        }\r\n                        _b = event.data.firebaseMessaging, type = _b.type, payload = _b.payload;\r\n                        if (this.onMessageCallback && type === MessageType.PUSH_RECEIVED) {\r\n                            this.onMessageCallback(payload);\r\n                        }\r\n                        data = payload.data;\r\n                        if (!(isConsoleMessage(data) &&\r\n                            data[CONSOLE_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3 /*break*/, 2];\r\n                        // Analytics is enabled on this message, so we should log it.\r\n                        return [4 /*yield*/, this.logEvent(type, data)];\r\n                    case 1:\r\n                        // Analytics is enabled on this message, so we should log it.\r\n                        _c.sent();\r\n                        _c.label = 2;\r\n                    case 2: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    WindowController.prototype.logEvent = function (messageType, data) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var eventType, analytics;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        eventType = getEventType(messageType);\r\n                        return [4 /*yield*/, this.firebaseDependencies.analyticsProvider.get()];\r\n                    case 1:\r\n                        analytics = _a.sent();\r\n                        analytics.logEvent(eventType, {\r\n                            /* eslint-disable camelcase */\r\n                            message_id: data[CONSOLE_CAMPAIGN_ID],\r\n                            message_name: data[CONSOLE_CAMPAIGN_NAME],\r\n                            message_time: data[CONSOLE_CAMPAIGN_TIME],\r\n                            message_device_time: Math.floor(Date.now() / 1000)\r\n                            /* eslint-enable camelcase */\r\n                        });\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return WindowController;\r\n}());\r\nfunction getEventType(messageType) {\r\n    switch (messageType) {\r\n        case MessageType.NOTIFICATION_CLICKED:\r\n            return 'notification_open';\r\n        case MessageType.PUSH_RECEIVED:\r\n            return 'notification_foreground';\r\n        default:\r\n            throw new Error();\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n/** Returns a promise that resolves after given time passes. */\r\nfunction sleep(ms) {\r\n    return new Promise(function (resolve) {\r\n        setTimeout(resolve, ms);\r\n    });\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar SwController = /** @class */ (function () {\r\n    function SwController(firebaseDependencies) {\r\n        var _this = this;\r\n        this.firebaseDependencies = firebaseDependencies;\r\n        this.vapidKey = null;\r\n        this.bgMessageHandler = null;\r\n        self.addEventListener('push', function (e) {\r\n            e.waitUntil(_this.onPush(e));\r\n        });\r\n        self.addEventListener('pushsubscriptionchange', function (e) {\r\n            e.waitUntil(_this.onSubChange(e));\r\n        });\r\n        self.addEventListener('notificationclick', function (e) {\r\n            e.waitUntil(_this.onNotificationClick(e));\r\n        });\r\n    }\r\n    Object.defineProperty(SwController.prototype, \"app\", {\r\n        get: function () {\r\n            return this.firebaseDependencies.app;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    /**\r\n     * Calling setBackgroundMessageHandler will opt in to some specific\r\n     * behaviours.\r\n     * 1.) If a notification doesn't need to be shown due to a window already\r\n     * being visible, then push messages will be sent to the page.\r\n     * 2.) If a notification needs to be shown, and the message contains no\r\n     * notification data this method will be called\r\n     * and the promise it returns will be passed to event.waitUntil.\r\n     * If you do not set this callback then all push messages will let and the\r\n     * developer can handle them in a their own 'push' event callback\r\n     *\r\n     * @param callback The callback to be called when a push message is received\r\n     * and a notification must be shown. The callback will be given the data from\r\n     * the push message.\r\n     */\r\n    SwController.prototype.setBackgroundMessageHandler = function (callback) {\r\n        if (!callback || typeof callback !== 'function') {\r\n            throw ERROR_FACTORY.create(\"invalid-bg-handler\" /* INVALID_BG_HANDLER */);\r\n        }\r\n        this.bgMessageHandler = callback;\r\n    };\r\n    // TODO: Remove getToken from SW Controller.\r\n    // Calling this from an old SW can cause all kinds of trouble.\r\n    SwController.prototype.getToken = function () {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var tokenDetails;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        if (!!this.vapidKey) return [3 /*break*/, 2];\r\n                        return [4 /*yield*/, dbGet(this.firebaseDependencies)];\r\n                    case 1:\r\n                        tokenDetails = _c.sent();\r\n                        this.vapidKey = (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY;\r\n                        _c.label = 2;\r\n                    case 2: return [2 /*return*/, getToken(this.firebaseDependencies, self.registration, this.vapidKey)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    // TODO: Remove deleteToken from SW Controller.\r\n    // Calling this from an old SW can cause all kinds of trouble.\r\n    SwController.prototype.deleteToken = function () {\r\n        return deleteToken(this.firebaseDependencies, self.registration);\r\n    };\r\n    SwController.prototype.requestPermission = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    // TODO: Deprecate this and make VAPID key a parameter in getToken.\r\n    // TODO: Remove this together with getToken from SW Controller.\r\n    SwController.prototype.usePublicVapidKey = function (vapidKey) {\r\n        if (this.vapidKey !== null) {\r\n            throw ERROR_FACTORY.create(\"use-vapid-key-after-get-token\" /* USE_VAPID_KEY_AFTER_GET_TOKEN */);\r\n        }\r\n        if (typeof vapidKey !== 'string' || vapidKey.length === 0) {\r\n            throw ERROR_FACTORY.create(\"invalid-vapid-key\" /* INVALID_VAPID_KEY */);\r\n        }\r\n        this.vapidKey = vapidKey;\r\n    };\r\n    SwController.prototype.useServiceWorker = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    SwController.prototype.onMessage = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    SwController.prototype.onTokenRefresh = function () {\r\n        throw ERROR_FACTORY.create(\"only-available-in-window\" /* AVAILABLE_IN_WINDOW */);\r\n    };\r\n    /**\r\n     * A handler for push events that shows notifications based on the content of\r\n     * the payload.\r\n     *\r\n     * The payload must be a JSON-encoded Object with a `notification` key. The\r\n     * value of the `notification` property will be used as the NotificationOptions\r\n     * object passed to showNotification. Additionally, the `title` property of the\r\n     * notification object will be used as the title.\r\n     *\r\n     * If there is no notification data in the payload then no notification will be\r\n     * shown.\r\n     */\r\n    SwController.prototype.onPush = function (event) {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var payload, clientList, notificationDetails;\r\n            return __generator(this, function (_a) {\r\n                switch (_a.label) {\r\n                    case 0:\r\n                        payload = getMessagePayload(event);\r\n                        if (!payload) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, getClientList()];\r\n                    case 1:\r\n                        clientList = _a.sent();\r\n                        if (hasVisibleClients(clientList)) {\r\n                            // App in foreground. Send to page.\r\n                            return [2 /*return*/, sendMessageToWindowClients(clientList, payload)];\r\n                        }\r\n                        notificationDetails = getNotificationData(payload);\r\n                        if (!notificationDetails) return [3 /*break*/, 3];\r\n                        return [4 /*yield*/, showNotification(notificationDetails)];\r\n                    case 2:\r\n                        _a.sent();\r\n                        return [3 /*break*/, 5];\r\n                    case 3:\r\n                        if (!this.bgMessageHandler) return [3 /*break*/, 5];\r\n                        return [4 /*yield*/, this.bgMessageHandler(payload)];\r\n                    case 4:\r\n                        _a.sent();\r\n                        _a.label = 5;\r\n                    case 5: return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onSubChange = function (event) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var newSubscription, tokenDetails;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        newSubscription = event.newSubscription;\r\n                        if (!!newSubscription) return [3 /*break*/, 2];\r\n                        // Subscription revoked, delete token\r\n                        return [4 /*yield*/, deleteToken(this.firebaseDependencies, self.registration)];\r\n                    case 1:\r\n                        // Subscription revoked, delete token\r\n                        _c.sent();\r\n                        return [2 /*return*/];\r\n                    case 2: return [4 /*yield*/, dbGet(this.firebaseDependencies)];\r\n                    case 3:\r\n                        tokenDetails = _c.sent();\r\n                        return [4 /*yield*/, deleteToken(this.firebaseDependencies, self.registration)];\r\n                    case 4:\r\n                        _c.sent();\r\n                        return [4 /*yield*/, getToken(this.firebaseDependencies, self.registration, (_b = (_a = tokenDetails === null || tokenDetails === void 0 ? void 0 : tokenDetails.subscriptionOptions) === null || _a === void 0 ? void 0 : _a.vapidKey) !== null && _b !== void 0 ? _b : DEFAULT_VAPID_KEY)];\r\n                    case 5:\r\n                        _c.sent();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    SwController.prototype.onNotificationClick = function (event) {\r\n        var _a, _b;\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var payload, link, client, message;\r\n            return __generator(this, function (_c) {\r\n                switch (_c.label) {\r\n                    case 0:\r\n                        payload = (_b = (_a = event.notification) === null || _a === void 0 ? void 0 : _a.data) === null || _b === void 0 ? void 0 : _b[FCM_MSG];\r\n                        if (!payload) {\r\n                            // Not an FCM notification, do nothing.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        else if (event.action) {\r\n                            // User clicked on an action button.\r\n                            // This will allow devs to act on action button clicks by using a custom\r\n                            // onNotificationClick listener that they define.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        // Prevent other listeners from receiving the event\r\n                        event.stopImmediatePropagation();\r\n                        event.notification.close();\r\n                        link = getLink(payload);\r\n                        if (!link) {\r\n                            return [2 /*return*/];\r\n                        }\r\n                        return [4 /*yield*/, getWindowClient(link)];\r\n                    case 1:\r\n                        client = _c.sent();\r\n                        if (!!client) return [3 /*break*/, 4];\r\n                        return [4 /*yield*/, self.clients.openWindow(link)];\r\n                    case 2:\r\n                        // Unable to find window client so need to open one.\r\n                        // This also focuses the opened client.\r\n                        client = _c.sent();\r\n                        // Wait three seconds for the client to initialize and set up the message\r\n                        // handler so that it can receive the message.\r\n                        return [4 /*yield*/, sleep(3000)];\r\n                    case 3:\r\n                        // Wait three seconds for the client to initialize and set up the message\r\n                        // handler so that it can receive the message.\r\n                        _c.sent();\r\n                        return [3 /*break*/, 6];\r\n                    case 4: return [4 /*yield*/, client.focus()];\r\n                    case 5:\r\n                        client = _c.sent();\r\n                        _c.label = 6;\r\n                    case 6:\r\n                        if (!client) {\r\n                            // Window Client will not be returned if it's for a third party origin.\r\n                            return [2 /*return*/];\r\n                        }\r\n                        message = createNewMessage(MessageType.NOTIFICATION_CLICKED, payload);\r\n                        return [2 /*return*/, client.postMessage(message)];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    return SwController;\r\n}());\r\nfunction getMessagePayload(_a) {\r\n    var data = _a.data;\r\n    if (!data) {\r\n        return null;\r\n    }\r\n    try {\r\n        return data.json();\r\n    }\r\n    catch (err) {\r\n        // Not JSON so not an FCM message.\r\n        return null;\r\n    }\r\n}\r\nfunction getNotificationData(payload) {\r\n    var _a;\r\n    if (!payload || typeof payload.notification !== 'object') {\r\n        return;\r\n    }\r\n    var notificationInformation = __assign({}, payload.notification);\r\n    // Put the message payload under FCM_MSG name so we can identify the\r\n    // notification as being an FCM notification vs a notification from\r\n    // somewhere else (i.e. normal web push or developer generated\r\n    // notification).\r\n    notificationInformation.data = __assign(__assign({}, payload.notification.data), (_a = {}, _a[FCM_MSG] = payload, _a));\r\n    return notificationInformation;\r\n}\r\n/**\r\n * @param url The URL to look for when focusing a client.\r\n * @return Returns an existing window client or a newly opened WindowClient.\r\n */\r\nfunction getWindowClient(url) {\r\n    return __awaiter(this, void 0, void 0, function () {\r\n        var parsedURL, clientList, clientList_1, clientList_1_1, client, parsedClientUrl;\r\n        var e_1, _a;\r\n        return __generator(this, function (_b) {\r\n            switch (_b.label) {\r\n                case 0:\r\n                    parsedURL = new URL(url, self.location.href);\r\n                    return [4 /*yield*/, getClientList()];\r\n                case 1:\r\n                    clientList = _b.sent();\r\n                    try {\r\n                        for (clientList_1 = __values(clientList), clientList_1_1 = clientList_1.next(); !clientList_1_1.done; clientList_1_1 = clientList_1.next()) {\r\n                            client = clientList_1_1.value;\r\n                            parsedClientUrl = new URL(client.url, self.location.href);\r\n                            if (parsedClientUrl.host === parsedURL.host) {\r\n                                return [2 /*return*/, client];\r\n                            }\r\n                        }\r\n                    }\r\n                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\r\n                    finally {\r\n                        try {\r\n                            if (clientList_1_1 && !clientList_1_1.done && (_a = clientList_1.return)) _a.call(clientList_1);\r\n                        }\r\n                        finally { if (e_1) throw e_1.error; }\r\n                    }\r\n                    return [2 /*return*/, null];\r\n            }\r\n        });\r\n    });\r\n}\r\n/**\r\n * @returns If there is currently a visible WindowClient, this method will\r\n * resolve to true, otherwise false.\r\n */\r\nfunction hasVisibleClients(clientList) {\r\n    return clientList.some(function (client) {\r\n        return client.visibilityState === 'visible' &&\r\n            // Ignore chrome-extension clients as that matches the background pages\r\n            // of extensions, which are always considered visible for some reason.\r\n            !client.url.startsWith('chrome-extension://');\r\n    });\r\n}\r\n/**\r\n * @param payload The data from the push event that should be sent to all\r\n * available pages.\r\n * @returns Returns a promise that resolves once the message has been sent to\r\n * all WindowClients.\r\n */\r\nfunction sendMessageToWindowClients(clientList, payload) {\r\n    var e_2, _a;\r\n    var message = createNewMessage(MessageType.PUSH_RECEIVED, payload);\r\n    try {\r\n        for (var clientList_2 = __values(clientList), clientList_2_1 = clientList_2.next(); !clientList_2_1.done; clientList_2_1 = clientList_2.next()) {\r\n            var client = clientList_2_1.value;\r\n            client.postMessage(message);\r\n        }\r\n    }\r\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\r\n    finally {\r\n        try {\r\n            if (clientList_2_1 && !clientList_2_1.done && (_a = clientList_2.return)) _a.call(clientList_2);\r\n        }\r\n        finally { if (e_2) throw e_2.error; }\r\n    }\r\n}\r\nfunction getClientList() {\r\n    return self.clients.matchAll({\r\n        type: 'window',\r\n        includeUncontrolled: true\r\n        // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\r\n    });\r\n}\r\nfunction createNewMessage(type, payload) {\r\n    return {\r\n        firebaseMessaging: { type: type, payload: payload }\r\n    };\r\n}\r\nfunction showNotification(details) {\r\n    var _a;\r\n    var title = (_a = details.title) !== null && _a !== void 0 ? _a : '';\r\n    var actions = details.actions;\r\n    // Note: Firefox does not support the maxActions property.\r\n    // https://developer.mozilla.org/en-US/docs/Web/API/notification/maxActions\r\n    var maxActions = Notification.maxActions;\r\n    if (actions && maxActions && actions.length > maxActions) {\r\n        console.warn(\"This browser only supports \" + maxActions + \" actions. The remaining actions will not be displayed.\");\r\n    }\r\n    return self.registration.showNotification(title, details);\r\n}\r\nfunction getLink(payload) {\r\n    var _a, _b, _c;\r\n    // eslint-disable-next-line camelcase\r\n    var link = (_b = (_a = payload.fcmOptions) === null || _a === void 0 ? void 0 : _a.link) !== null && _b !== void 0 ? _b : (_c = payload.notification) === null || _c === void 0 ? void 0 : _c.click_action;\r\n    if (link) {\r\n        return link;\r\n    }\r\n    if (isConsoleMessage(payload.data)) {\r\n        // Notification created in the Firebase Console. Redirect to origin.\r\n        return self.location.origin;\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\n\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nvar MESSAGING_NAME = 'messaging';\r\nfunction factoryMethod(container) {\r\n    // Dependencies.\r\n    var app = container.getProvider('app').getImmediate();\r\n    var appConfig = extractAppConfig(app);\r\n    var installations = container.getProvider('installations').getImmediate();\r\n    var analyticsProvider = container.getProvider('analytics-internal');\r\n    var firebaseDependencies = {\r\n        app: app,\r\n        appConfig: appConfig,\r\n        installations: installations,\r\n        analyticsProvider: analyticsProvider\r\n    };\r\n    if (!isSupported()) {\r\n        throw ERROR_FACTORY.create(\"unsupported-browser\" /* UNSUPPORTED_BROWSER */);\r\n    }\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return new SwController(firebaseDependencies);\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return new WindowController(firebaseDependencies);\r\n    }\r\n}\r\nvar NAMESPACE_EXPORTS = {\r\n    isSupported: isSupported\r\n};\r\nfirebase.INTERNAL.registerComponent(new Component(MESSAGING_NAME, factoryMethod, \"PUBLIC\" /* PUBLIC */).setServiceProps(NAMESPACE_EXPORTS));\r\nfunction isSupported() {\r\n    if (self && 'ServiceWorkerGlobalScope' in self) {\r\n        // Running in ServiceWorker context\r\n        return isSWControllerSupported();\r\n    }\r\n    else {\r\n        // Assume we are in the window context.\r\n        return isWindowControllerSupported();\r\n    }\r\n}\r\n/**\r\n * Checks to see if the required APIs exist.\r\n */\r\nfunction isWindowControllerSupported() {\r\n    return ('indexedDB' in window &&\r\n        indexedDB !== null &&\r\n        navigator.cookieEnabled &&\r\n        'serviceWorker' in navigator &&\r\n        'PushManager' in window &&\r\n        'Notification' in window &&\r\n        'fetch' in window &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\r\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\r\nfunction isSWControllerSupported() {\r\n    return ('indexedDB' in self &&\r\n        indexedDB !== null &&\r\n        'PushManager' in self &&\r\n        'Notification' in self &&\r\n        ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') &&\r\n        PushSubscription.prototype.hasOwnProperty('getKey'));\r\n}\n//# sourceMappingURL=index.esm.js.map\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","import '@firebase/messaging';\n//# sourceMappingURL=index.esm.js.map\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (global = global || self, factory(global.idb = {}));\n}(this, function (exports) { 'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function(resolve, reject) {\n      request.onsuccess = function() {\n        resolve(request.result);\n      };\n\n      request.onerror = function() {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function(resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function(value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function(prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function() {\n          return this[targetProp][prop];\n        },\n        set: function(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function(prop) {\n      if (!(prop in Constructor.prototype)) return;\n      ProxyClass.prototype[prop] = function() {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', [\n    'name',\n    'keyPath',\n    'multiEntry',\n    'unique'\n  ]);\n\n  proxyRequestMethods(Index, '_index', IDBIndex, [\n    'get',\n    'getKey',\n    'getAll',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', [\n    'direction',\n    'key',\n    'primaryKey',\n    'value'\n  ]);\n\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, [\n    'update',\n    'delete'\n  ]);\n\n  // proxy 'next' methods\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function(methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n    Cursor.prototype[methodName] = function() {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function() {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n        return promisifyRequest(cursor._request).then(function(value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function() {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function() {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', [\n    'name',\n    'keyPath',\n    'indexNames',\n    'autoIncrement'\n  ]);\n\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'put',\n    'add',\n    'delete',\n    'clear',\n    'get',\n    'getAll',\n    'getKey',\n    'getAllKeys',\n    'count'\n  ]);\n\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, [\n    'openCursor',\n    'openKeyCursor'\n  ]);\n\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, [\n    'deleteIndex'\n  ]);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function(resolve, reject) {\n      idbTransaction.oncomplete = function() {\n        resolve();\n      };\n      idbTransaction.onerror = function() {\n        reject(idbTransaction.error);\n      };\n      idbTransaction.onabort = function() {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function() {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', [\n    'objectStoreNames',\n    'mode'\n  ]);\n\n  proxyMethods(Transaction, '_tx', IDBTransaction, [\n    'abort'\n  ]);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function() {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, [\n    'deleteObjectStore',\n    'close'\n  ]);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function() {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', [\n    'name',\n    'version',\n    'objectStoreNames'\n  ]);\n\n  proxyMethods(DB, '_db', IDBDatabase, [\n    'close'\n  ]);\n\n  // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n  ['openCursor', 'openKeyCursor'].forEach(function(funcName) {\n    [ObjectStore, Index].forEach(function(Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function() {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n        request.onsuccess = function() {\n          callback(request.result);\n        };\n      };\n    });\n  });\n\n  // polyfill getAll\n  [Index, ObjectStore].forEach(function(Constructor) {\n    if (Constructor.prototype.getAll) return;\n    Constructor.prototype.getAll = function(query, count) {\n      var instance = this;\n      var items = [];\n\n      return new Promise(function(resolve) {\n        instance.iterateCursor(query, function(cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n          cursor.continue();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function(event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function(db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n}));\n"]}